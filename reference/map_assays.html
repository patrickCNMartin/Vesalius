<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Aling and integrate spatial assay from the same modality using super pixels — map_assays • vesalius</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Aling and integrate spatial assay from the same modality using super pixels — map_assays"><meta property="og:description" content="Aling and integrate spatial assay from the same modality using super pixels"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vesalius</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/vesalius.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Vesalius_Analysis/Spatial_DNA_seq.html">Vesalius: Spatial Genomics</a>
    </li>
    <li>
      <a href="../articles/Vesalius_Analysis/Spatial_Transcriptomics.html">Vesalius: Spatial Transcriptomics</a>
    </li>
    <li>
      <a href="../articles/Vesalius_Analysis/Vesalius_MSB_analysis.html">Vesalius: MSB Manuscript Analysis</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/patrickCNMartin/Vesalius/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aling and integrate spatial assay from the same modality using super pixels</h1>
    <small class="dont-index">Source: <a href="https://github.com/patrickCNMartin/Vesalius/blob/main/R/map_assays.R" class="external-link"><code>R/map_assays.R</code></a></small>
    <div class="hidden name"><code>map_assays.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Aling and integrate spatial assay from the same modality using super pixels</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">map_assays</span><span class="op">(</span></span>
<span>  <span class="va">seed_assay</span>,</span>
<span>  <span class="va">query_assay</span>,</span>
<span>  neighborhood <span class="op">=</span> <span class="st">"knn"</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  depth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  norm <span class="op">=</span> <span class="st">"noise"</span>,</span>
<span>  mapping <span class="op">=</span> <span class="st">"div"</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  signal <span class="op">=</span> <span class="st">"variable_features"</span>,</span>
<span>  use_norm <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>  custom_cost <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  merge <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>seed_assay</dt>
<dd><p>vesalius_assay object - data to be mapped to</p></dd>


<dt>query_assay</dt>
<dd><p>vesalius_assay objecy - data to map</p></dd>


<dt>neighborhood</dt>
<dd><p>character - how should the neighborhood be selected?
"knn", "radius", "depth" (See details)</p></dd>


<dt>k</dt>
<dd><p>int ]2, n_points] number of neareset neighbors to be considered for
neighborhodd computation.</p></dd>


<dt>radius</dt>
<dd><p>numeric ]0,1[ proportion of max distance between points 
to consider for the neighborhood</p></dd>


<dt>depth</dt>
<dd><p>int [1, NA] graph depth from cell to consider from neighborhood
(See details)</p></dd>


<dt>dimensions</dt>
<dd><p>Int vector containing latent space dimensions to use</p></dd>


<dt>mapping</dt>
<dd><p>character string (div - exact) - mapping strategy.
Divide and conquer (approximate) or Exact mapping.</p></dd>


<dt>batch_size</dt>
<dd><p>number of points per batch in query during assignment
problem solving</p></dd>


<dt>signal</dt>
<dd><p>character (variable_features, all_features, embeddings, custom)
- What should  be used as cell signal to generate the cost matrix.
Seed details</p></dd>


<dt>use_norm</dt>
<dd><p>character - which count data to use</p></dd>


<dt>custom_cost</dt>
<dd><p>matrix - matrix of size n (query cells) by p (seed cells)
containing custom cost matrix. Used instead of vesalius cost matrix</p></dd>


<dt>overwrite</dt>
<dd><p>logical - if custom_cost is not NULL, should this matrix
be added to the vesalius matrix or should it overwrite it completely.</p></dd>


<dt>verbose</dt>
<dd><p>logical - should I be a noisy boy?</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>vesalius_assay</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The goal is to assign the best matching point between a seed set and
a query set.</p>
<p>To do so, <code>integrate_horizontally</code> will first extract a
biological signal. This can be latent space embeddings per cell, or by using
gene counts (or any other modality).</p>
<p>If using gene counts, there are a few more options available to
you. First, you can select "variable_features" and vesalius will find the
intersection between the variable features in your seed_assay and your
query_assay. "all_features" will find the intersection of all genes across
assays (even if they are not highly variable). Finally, you can also select
a custom gene vector, containing only the gene set you are interested in.</p>
<p>The second step is to create a cost matrix. The cost matrix computes the
distance (using the signal) betwwen each point in the seed and query. It
also includes the distance in signal between each points neighborhoods.
The neighborhood singal is computed by averaging the signal across k
nearest neighbors in space if using Knn. If using radius, the neighborhood
will be computed using all cells within a definined radius. 
If using depth, coordinates will be used to create a voronoi graph. 
The neighborhood will be composed of all cells with "depth" steps i.e.
how many nodes in the graph do you need to go through to get to taget cell?
A depth of one will contain all cells in direct contact with center cell.</p>

<p>This cost matrix is then parsed to a
Kuhn–Munkres algorithm that will generate point pairs that minimize
the overall cost.</p>
<p>Since the algorithm complexity is O(n3), it can be time consuming to
to run on larger data sets. We recomned using "exact" mapping when
there are less then 1500 points (a few minutes) and use "div" 
with larger data sets. The "div" option will split the query data
into random batches of pre-defined size (batch_size). The optimization
will be run on each batch serately and the results will be concatenated
together. Note this will not be an exact match but an approximation.</p>
<p>Finaly once the matches are found, the coordinates are mapped to its
corresponding point and a new object is returned.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Patrick C.N. Martin.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

